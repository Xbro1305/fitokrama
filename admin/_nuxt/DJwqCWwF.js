import{_ as A}from"./C-6ur_D0.js";import{u as F}from"./C0pAtJqh.js";import{d as P,C as H,r as f,D as k,E as v,A as u,q as O,t as b,z as l,B as _,F as n,y as Q,G as q,H as C,I as z,J as h}from"./B1_Hl8uH.js";import{k as G}from"./CfZuxCf1.js";import{u as J}from"./DQpfZfJT.js";import{V as L,a as w,b as E}from"./C-rbV1EV.js";import{V as y,a as Y}from"./BaPA-ebZ.js";import{V as T}from"./l_kyqZ6E.js";import{V as j}from"./BrzFJEKX.js";import{V as K}from"./CJMpZFdM.js";import"./BvXpFEPO.js";/* empty css        */import"./Ct-uUTWm.js";import"./D6i0_gJv.js";import"./BnsnIHaH.js";import"./DWGaNmQL.js";import"./hfnGxc_G.js";import"./Ca84myvZ.js";import"./Bw0Jv46Q.js";import"./CzA-VZ75.js";const ye=P({__name:"assembly_order",setup(M){F({title:"Сборка заказа"});const{showError:I,showSuccess:c}=J(),{email:V,password:g}=H(),N=O().public.backendUrl,s=f(null),d=f(""),r=f(1),p=f([]),i=f([]);k(p,()=>{setTimeout(()=>{p.value.length>0&&(p.value=[])},1e3)}),k(i,()=>{setTimeout(()=>{i.value.length>0&&(i.value=[])},1e3)});const x=[{title:"Артикул",key:"good_art"},{title:"Barcode",key:"barcode"},{title:"Название",key:"name"},{title:"Количество",key:"qty"},{title:"Собрано",key:"qty_as"}],S=async m=>{const{data:e}=await h(`${N}/order_details.php`,{method:"POST",body:{staff_login:V,staff_password:g,number:"883440"}},"$enA4Lu5IYl");e.value.order?(s.value=e.value.order,s.value.goods.forEach(t=>{Number.parseInt(t.qty_as)!==0&&I("Заказ содержит уже отсканированные товары, однако их необходимо отсканировать снова")})):e.value.error&&I(e.value.error)},B=m=>new Promise(e=>setTimeout(e,m)),$=async()=>{let m=!1;if(s.value.goods.forEach(t=>{t.barcode===d.value&&(m=!0)}),!m){p.value=["Лишний товар!"];return}if(Number.parseInt(r.value)<1){i.value=["Количество меньше нуля!"];return}s.value.goods.forEach(t=>{t.barcode===d.value&&(Number.parseInt(t.qty_as)+Number.parseInt(r.value)>Number.parseInt(t.qty)?i.value=["Лишний товар!"]:t.qty_as=Number.parseInt(t.qty_as)+Number.parseInt(r.value))});let e=!0;if(s.value.goods.forEach(t=>{Number.parseInt(t.qty_as)<Number.parseInt(t.qty)&&(e=!1)}),e){c("Заказ собран!");const t=[];s.value.goods.forEach(a=>{t.push({good_art:a.good_art,qty_as:a.qty_as})});const{data:o}=await h(`${N}/order_assembled.php`,{method:"POST",body:{staff_login:V,staff_password:g,order_number:s.value.number,goods:t}},"$9Wv8IUDWpt");if(o.value.message&&c(o.value.message),o.value.error&&c(o.value.error),o.value.html_for_print){const a=window.open("","_blank");a==null||a.document.write(o.value.html_for_print),B(200).then(()=>{a==null||a.document.close(),a==null||a.focus(),a==null||a.print()})}}},D=m=>{if(Number.parseInt(m.item.qty)===Number.parseInt(m.item.qty_as))return{class:"bg-green"}},U=()=>{Number.parseInt(r.value)<999&&(r.value=Number.parseInt(r.value)+1)},R=()=>{Number.parseInt(r.value)>1&&(r.value=Number.parseInt(r.value)-1)};return(m,e)=>{const t=A;return b(),v(L,null,{default:u(()=>[l(w,null,{default:u(()=>e[4]||(e[4]=[_(" Сборка заказа ")])),_:1}),l(E,null,{default:u(()=>[l(t,{onCodeScanned:S})]),_:1}),n(s)?(b(),v(w,{key:0},{default:u(()=>[_(" №"+Q(n(s).number),1)]),_:1})):q("",!0),n(s)?(b(),v(E,{key:1},{default:u(()=>[l(Y,null,{default:u(()=>[l(y,{cols:"12",md:"5"},{default:u(()=>[l(T,{modelValue:n(d),"onUpdate:modelValue":e[0]||(e[0]=o=>C(d)?d.value=o:null),label:"Barcode",density:"compact",variant:"outlined","error-messages":n(p),onInput:e[1]||(e[1]=o=>p.value=[])},null,8,["modelValue","error-messages"])]),_:1}),l(y,{cols:"12",md:"5"},{default:u(()=>[z(l(T,{modelValue:n(r),"onUpdate:modelValue":e[2]||(e[2]=o=>C(r)?r.value=o:null),label:"Количество",density:"compact",variant:"outlined","append-icon":"mdi-plus","prepend-icon":"mdi-minus","error-messages":n(i),onInput:e[3]||(e[3]=o=>i.value=[]),"onClick:prepend":R,"onClick:append":U},null,8,["modelValue","error-messages"]),[[n(G),"###"]])]),_:1}),l(y,{cols:"12",md:"2"},{default:u(()=>[l(j,{color:"primary",disabled:!n(d),onClick:$},{default:u(()=>e[5]||(e[5]=[_(" Добавить ")])),_:1},8,["disabled"])]),_:1})]),_:1}),l(K,{headers:x,items:n(s).goods,"row-props":D},null,8,["items"])]),_:1})):q("",!0)]),_:1})}}});export{ye as default};
